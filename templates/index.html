{% extends "base.html" %}

{% block title %}Aurum Joyería | Inicio{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/inicio.css') }}">
{% endblock %}

{% block extra_js %}
<script defer src="{{ url_for('static', path='js/cargar_destacados.js') }}"></script>
<script defer src="{{ url_for('static', path='js/carrito.js') }}"></script>
{% endblock %}

{% block content %}
<!-- CARRUSEL -->
<section class="carrusel" id="carrusel">
  <div class="slides">
    <!-- Las imágenes se cargarán dinámicamente -->
  </div>
  <div class="dots">
    <!-- Los dots se generarán dinámicamente -->
  </div>
</section>

<!-- PRODUCTOS DESTACADOS -->
<section class="productos-destacados">
  <h2>Productos destacados</h2>
  <div class="productos-grid">
    <!-- Los productos se cargan aquí con JavaScript -->
  </div>
</section>

<!-- COLECCIONES DESTACADAS -->
<section class="colecciones-destacadas">
  <h2>Nuestras colecciones</h2>
  <div class="colecciones-grid">

    <a href="{{ url_for('anillos') }}" class="coleccion-card">
      <img src="{{ url_for('static', path='img/oro2anillo.jpg') }}" alt="Anillos" loading="lazy">
      <h3>Anillos</h3>
      <span class="btn-ver-mas">Ver colección</span>
    </a>

    <a href="{{ url_for('pulseras') }}" class="coleccion-card">
      <img src="{{ url_for('static', path='img/PULSERA BALI LAMINADO.jpg') }}" alt="Pulseras" loading="lazy">
      <h3>Pulseras</h3>
      <span class="btn-ver-mas">Ver colección</span>
    </a>

    <a href="{{ url_for('cadenas') }}" class="coleccion-card">
      <img src="{{ url_for('static', path='img/CADENAS TIPOS VARIAS.jpg') }}" alt="Cadenas" loading="lazy">
      <h3>Cadenas</h3>
      <span class="btn-ver-mas">Ver colección</span>
    </a>

    <a href="{{ url_for('aretes') }}" class="coleccion-card">
      <img src="{{ url_for('static', path='img/TOPOS CIRCON VERDE.jpg') }}" alt="Aretes" loading="lazy">
      <h3>Aretes</h3>
      <span class="btn-ver-mas">Ver colección</span>
    </a>

    <a href="{{ url_for('tobilleras') }}" class="coleccion-card">
      <img src="{{ url_for('static', path='img/TOBILLERA 4.png') }}" alt="Tobilleras" loading="lazy">
      <h3>Tobilleras</h3>
      <span class="btn-ver-mas">Ver colección</span>
    </a>

    <a href="{{ url_for('more_products') }}" class="coleccion-card">
      <img src="{{ url_for('static', path='img/DIJE BOLSA DE DINEROS.webp') }}" alt="Más productos" loading="lazy">
      <h3>Más productos</h3>
      <span class="btn-ver-mas">Ver colección</span>
    </a>

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', async () => {
  await cargarCarruselDinamico();
});

async function cargarCarruselDinamico() {
  const slidesContainer = document.querySelector('.slides');
  const dotsContainer = document.querySelector('.dots');
  
  try {
    const items = await carruselAPI.getAll(true);
    
    if (items.length === 0) {
      usarCarruselPredeterminado();
      return;
    }
    
    slidesContainer.innerHTML = '';
    dotsContainer.innerHTML = '';
    
    items.forEach((item, index) => {
      const slide = document.createElement('div');
      slide.className = `slide ${index === 0 ? 'active' : ''}`;
      slide.style.backgroundImage = `url('${item.imagen_url}')`;
      slidesContainer.appendChild(slide);
      
      const dot = document.createElement('span');
      dot.className = `dot ${index === 0 ? 'active' : ''}`;
      dot.dataset.index = index;
      dotsContainer.appendChild(dot);
    });
    
    inicializarCarrusel();
    
  } catch (error) {
    console.error('Error cargando carrusel:', error);
    usarCarruselPredeterminado();
  }
}

function usarCarruselPredeterminado() {
  const slidesContainer = document.querySelector('.slides');
  const dotsContainer = document.querySelector('.dots');
  
  slidesContainer.innerHTML = `
    <div class="slide active" style="background-image: url('{{ url_for('static', path='img/oro18k.png') }}');"></div>
    <div class="slide" style="background-image: url('{{ url_for('static', path='img/anillos.png') }}');"></div>
    <div class="slide" style="background-image: url('{{ url_for('static', path='img/carru_puls.png') }}');"></div>
  `;
  
  dotsContainer.innerHTML = `
    <span class="dot active" data-index="0"></span>
    <span class="dot" data-index="1"></span>
    <span class="dot" data-index="2"></span>
  `;
  
  inicializarCarrusel();
}

function inicializarCarrusel() {
  const slides = document.querySelectorAll('.slide');
  const dots = document.querySelectorAll('.dot');
  let currentSlide = 0;
  const totalSlides = slides.length;
  
  if (totalSlides === 0) return;

  function showSlide(index) {
    if (index < 0) index = totalSlides - 1;
    if (index >= totalSlides) index = 0;

    document.querySelector('.slides').style.transform = `translateX(-${index * 100}%)`;

    dots.forEach(dot => dot.classList.remove('active'));
    if (dots[index]) dots[index].classList.add('active');

    currentSlide = index;
  }

  dots.forEach(dot => {
    dot.addEventListener('click', () => showSlide(parseInt(dot.dataset.index)));
  });

  let autoplayInterval = setInterval(() => {
    showSlide(currentSlide + 1);
  }, 6000);

  const carruselElement = document.querySelector('.carrusel');
  carruselElement.addEventListener('mouseenter', () => clearInterval(autoplayInterval));
  carruselElement.addEventListener('mouseleave', () => {
    autoplayInterval = setInterval(() => showSlide(currentSlide + 1), 6000);
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      clearInterval(autoplayInterval);
      showSlide(currentSlide - 1);
    } else if (e.key === 'ArrowRight') {
      clearInterval(autoplayInterval);
      showSlide(currentSlide + 1);
    }
  });
}
</script>
<script src="{{ url_for('static', path='js/verification-banner.js') }}"></script>
{% endblock %}